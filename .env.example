# =============================================================================
# Invoice Pipeline — Environment Configuration
# =============================================================================
#
# USAGE
#   1. Copy this file:   cp .env.example .env
#   2. Edit .env with your actual values
#   3. Docker Compose loads .env automatically — no extra flags needed:
#        docker compose run --rm pipeline check
#
# NOTE: .env is excluded from the Docker image build (via .dockerignore).
#       It is only read by Docker Compose at runtime on the host machine.
#       Never commit .env to version control.
# =============================================================================


# -----------------------------------------------------------------------------
# LLM — connection (OpenAI-compatible API)
# -----------------------------------------------------------------------------

# Base URL of the LLM API endpoint.
# The pipeline uses the OpenAI client, so any OpenAI-compatible backend works.
#
# Ollama on this machine (default):
#   LLM_BASE_URL=http://host.docker.internal:11434/v1
#
# Ollama on another machine:
#   LLM_BASE_URL=http://192.168.1.50:11434/v1
#
# Ollama sidecar container (when using --profile with-ollama):
#   LLM_BASE_URL=http://ollama:11434/v1
#
# OpenAI:
#   LLM_BASE_URL=https://api.openai.com/v1
#
# Groq (fast hosted inference, free tier available):
#   LLM_BASE_URL=https://api.groq.com/openai/v1
#
LLM_BASE_URL=http://host.docker.internal:11434/v1

# Model name to use for invoice extraction.
#
# Ollama (local) — recommended:
#   LLM_MODEL=qwen2.5:7b       ← best JSON accuracy
#   LLM_MODEL=llama3.2         ← good general extraction (default)
#   LLM_MODEL=mistral
#
# OpenAI:
#   LLM_MODEL=gpt-4o-mini      ← cost-effective, excellent accuracy
#   LLM_MODEL=gpt-4o
#
# Groq:
#   LLM_MODEL=llama-3.3-70b-versatile
#   LLM_MODEL=mixtral-8x7b-32768
#
LLM_MODEL=llama3.2

# API key for the LLM backend.
#
# Ollama does not require a real key — any non-empty string works:
#   LLM_API_KEY=ollama
#
# For OpenAI, Groq, or other hosted services, use your actual API key:
#   LLM_API_KEY=sk-...         (OpenAI)
#   LLM_API_KEY=gsk_...        (Groq)
#
LLM_API_KEY=ollama


# -----------------------------------------------------------------------------
# Watch / polling mode
# -----------------------------------------------------------------------------

# Selects the default processing mode when no explicit subcommand is given.
#
# false (default) — run a single batch pass over invoices/ then exit.
#                   Use with:  docker compose run --rm pipeline
#                              or a cron / scheduled task.
#
# true            — continuously poll invoices/ and process new PDFs.
#                   Use with:  docker compose up -d
#                              (optionally with restart: unless-stopped in compose)
#
# Note: explicit subcommands always override this setting:
#   docker compose run --rm pipeline process /app/invoices   ← always batch
#   docker compose run --rm pipeline watch   /app/invoices   ← always watch
#
WATCH_MODE=false

# How many seconds to wait between directory scans when running in watch mode.
#
# Lower values = faster response to new invoices, higher CPU idle usage.
# Recommended range: 15–120 seconds.
#
POLL_INTERVAL=30


# -----------------------------------------------------------------------------
# Extraction mode
# -----------------------------------------------------------------------------

# Use Docling for PDF extraction (accuracy-first, recommended).
#
# true  — DoclingExtractor: layout-aware, table-preserving, built-in OCR.
#         Downloads ~1 GB of ML models on first run (cached in a named volume).
#
# false — PlainTextExtractor: pdfplumber, fast but no table structure.
#         Use for quick tests or when Docling is unavailable.
#
USE_DOCLING=true

# -----------------------------------------------------------------------------
# Dashboard
# -----------------------------------------------------------------------------

# Port the dashboard web UI listens on (access at http://localhost:<port>)
DASHBOARD_PORT=8080

# -----------------------------------------------------------------------------
# Dashboard authentication (optional)
# -----------------------------------------------------------------------------

# Authentication mode.
#
# disabled    — no login required, open access (default).
#
# admin_only  — main dashboard is public; /admin and all /api/admin/* routes
#               require an admin login. Suitable for internal networks where
#               the dashboard itself is safe to expose but admin ops need a gate.
#
# full        — all routes require login; admin routes additionally require the
#               admin role. Recommended for any internet-facing deployment.
#
# AUTH_MODE=disabled

# Secret key used to sign session cookies.
# Required when AUTH_MODE is admin_only or full.
# Use a long random string — e.g.: openssl rand -hex 32
#
# AUTH_SECRET_KEY=replace-with-a-long-random-secret

# Session lifetime in minutes (default: 480 = 8 hours).
#
# AUTH_SESSION_MINUTES=480

# -----------------------------------------------------------------------------
# Supplier creation (optional)
# -----------------------------------------------------------------------------

# Allow the dashboard to create new supplier records directly from the invoice
# edit view. When enabled, a "Create" button appears next to the supplier section.
#
# ALLOW_CREATE_SUPPLIER=false

# Prefix applied to auto-generated supplier IDs when ALLOW_CREATE_SUPPLIER=true.
# The numeric suffix increments from the highest existing ID with this prefix.
# Examples:  SUP-   →  SUP-1, SUP-2, …
#            SUPP-  →  SUPP-1, SUPP-2, …
#
# SUPPLIER_CODE_PREFIX=SUP-

# -----------------------------------------------------------------------------
# Storage paths (optional — defaults shown, override if needed)
# -----------------------------------------------------------------------------
#
# NOTE: The paths below are locations INSIDE the container.
# They must match the right-hand side of the volume mounts in docker-compose.yml.
# Only change these if you are also changing the volume mount targets.
#
# Internal container paths (default values match the docker-compose volume mounts):
# OUTPUT_DIR=/app/output
# INVOICES_DIR=/app/invoices
# DATA_DIR=/app/data
# CONFIG_DIR=/app/config

# SQLite database file path inside the container.
# Change this if you want the database in a different location or named volume.
# DB_PATH=/app/output/pipeline.db

# Directory where approved invoices are written for backend pickup.
# The backend system should monitor this folder, consume the files, and delete them.
# EXPORT_DIR=/app/output/export

# -----------------------------------------------------------------------------
# Export format
# -----------------------------------------------------------------------------

# Format used when writing approved invoices to EXPORT_DIR.
#
# json (default) — writes <stem>.json only.
# xml            — writes <stem>.xml rendered from config/export_template.xml.j2
# both           — writes both <stem>.json and <stem>.xml
#
# The PDF is always written as <stem>.pdf regardless of this setting.
# To customise the XML structure, edit config/export_template.xml.j2.
#
# EXPORT_FORMAT=json

# -----------------------------------------------------------------------------
# Build info (optional — for CI/CD and the admin Settings page)
# -----------------------------------------------------------------------------

# Short git commit hash or version tag shown in the admin Settings page.
# Set this in your CI/CD pipeline or deployment script so the running version
# is always visible in the UI without needing to inspect container logs.
# Example:  BUILD_COMMIT=$(git rev-parse --short HEAD)
#
# BUILD_COMMIT=
